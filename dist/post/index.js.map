{"version":3,"file":"index.js","sources":["../webpack://step-security-harden-runner/webpack/bootstrap","../webpack://step-security-harden-runner/webpack/runtime/make namespace object","../webpack://step-security-harden-runner/webpack/runtime/compat","../webpack://step-security-harden-runner/external \"fs\"","../webpack://step-security-harden-runner/external \"child_process\"","../webpack://step-security-harden-runner/./src/cleanup.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"fs\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"child_process\");","import * as fs from \"fs\";\nimport * as cp from \"child_process\";\n\n(async () => {\n  if (process.platform !== \"linux\") {\n    console.log(\"Only runs on linux\");\n    return;\n  }\n\n  fs.writeFileSync(\n    \"/home/agent/post_event.json\",\n    JSON.stringify({ event: \"post\" })\n  );\n\n  var doneFile = \"/home/agent/done.json\";\n  var counter = 0;\n  while (true) {\n    if (!fs.existsSync(doneFile)) {\n      counter++;\n      if (counter > 10) {\n        console.log(\"timed out\");\n\n        break;\n      }\n      await sleep(1000);\n    } // The file *does* exist\n    else {\n      break;\n    }\n  }\n\n  var log = \"/home/agent/agent.log\";\n  console.log(\"log:\");\n  var content = fs.readFileSync(log, \"utf-8\");\n  console.log(content);\n  var status = \"/home/agent/agent.status\";\n  if (fs.existsSync(status)) {\n    console.log(\"status:\");\n    var content = fs.readFileSync(status, \"utf-8\");\n    console.log(content);\n  }\n\n  if (!fs.existsSync(doneFile)) {\n    cp.execSync(\"sudo journalctl -u agent.service\");\n  }\n})();\n\nfunction sleep(ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n}\n"],"mappings":";;AAAA;AACA;AACA;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACNA;AACA;;;;;;;;ACDA;;ACAA;;;;;;;;;;;ACAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}